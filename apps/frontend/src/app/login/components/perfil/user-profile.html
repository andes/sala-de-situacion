<plex-layout>
    <plex-layout-main>
        <plex-title titulo="Perfil de usuario">
            <plex-button type="info" size="sm">Preguntas/Sugerencias</plex-button>
        </plex-title>
        <div class="row">
            <div class="col-md-4 col-sm-12 mt-4">
                <plex-title size="sm" titulo="Mis datos"></plex-title>
                <plex-detail size="lg">
                    <!-- <img src="{{ usuario.foto }}" alt=""> -->
                    <!-- <plex-badge size="xs">{{ usuario.estado }}</plex-badge> -->
                    <plex-icon name="account"></plex-icon>
                    <div title> {{user.apellido}}, {{user.nombre}} </div>
                    <div subtitle> {{user.email}} </div>
                    <plex-label titulo="Documento" subtitulo="{{user.documento}}"></plex-label>
                    <plex-label titulo="Teléfono" subtitulo="{{user.telefono}}"></plex-label>

                </plex-detail>
                <plex-button size="sm" type="info" (click)="showResetForm()">
                    Cambiar contraseña
                </plex-button>

            </div>
            <div class="col-md-8 col-sm-12 mt-4">
                <plex-title size="sm" titulo="Mis Instituciones"></plex-title>
                <div class="w-100">
                    <plex-wrapper>
                        <b>Nombre</b>
                        <b>Email</b>
                        <b>Teléfono</b>
                        <b>Dirección</b>
                        <b> </b>
                    </plex-wrapper>
                    <plex-wrapper *ngFor="let institution of institutions; let i=index" collapse>
                        <plex-label><a class="hover" [routerLink]="'institution/list'"
                               title="">{{ institution.nombre }}</a>
                        </plex-label>
                        <plex-label>{{ institution.email }}</plex-label>
                        <plex-label>{{ institution.telefono }}</plex-label>
                        <plex-label>{{ institution.direccion }}</plex-label>
                        <div justify="start">
                            <div>
                                <plex-badge *ngIf="institution.activo" type="success">Habilitada</plex-badge>
                                <plex-badge *ngIf="!institution.activo" type="danger">Deshabilitada</plex-badge>
                            </div>
                            <plex-button type="info" size="sm" icon="format-list-text" title="Lista de usuarios"
                                         titlePosition="left" (click)="showUsarios[i] = !showUsarios[i]">
                            </plex-button>
                        </div>
                        <div class="w-75" *ngIf="showUsarios[i]">
                            <plex-title size="sm" titulo="Usuarios de esta Institución">
                                <!-- <plex-select name="select-{{ i }}" [(ngModel)]="usuariosInstitucion"
                                 [data]="institutions"></plex-select> -->
                                <plex-button size="sm" type="info" icon="account-plus" title="Agregar usuario"
                                             titlePosition="left"></plex-button>
                            </plex-title>
                            <plex-list>
                                <plex-item *ngFor="let user of institution.users">
                                    <plex-label titulo="{{ user.apellido }}, {{ user.nombre }}"
                                                subtitulo="{{ user.email }}" size="sm">
                                    </plex-label>
                                    <plex-button type="danger" icon="account-minus" size="sm">
                                    </plex-button>
                                </plex-item>
                            </plex-list>
                            <hr>
                            <div justify>
                                <plex-select placeholder="Seleccionar usuario..." grow="2" [data]="users"
                                             [(ngModel)]="selectedUsers" label-field="apellido + ' ' + apellido">
                                </plex-select>
                                <plex-button type="success" icon="account-plus" size="sm"></plex-button>
                            </div>
                        </div>
                    </plex-wrapper>
                </div>
            </div>
        </div>
        <div class="row" *ngIf="showResetPassword">
            <div class="col-4">
                <form #passForm="ngForm">
                    <div class="mb-2 text-default">Crear una contraseña nueva</div>
                    <div class="usuario mb-2">
                        <plex-text placeholder="Ingresá la contraseña actual" [(ngModel)]="passwordActual"
                                   [required]="true" name="passwordActual" [password]="!auth.showPassword">
                        </plex-text>
                        <plex-text placeholder="Ingresá una nueva contraseña" [(ngModel)]="password1" [required]="true"
                                   name="password1" [password]="!auth.showPassword">
                        </plex-text>
                        <plex-icon class="hover" [name]="auth.eye" type="info" size="24" [title]="auth.passwordTooltip"
                                   (click)="auth.toggleEye()">
                        </plex-icon>
                    </div>
                    <div class="password mb-3">
                        <plex-text placeholder="Confirmá tu nueva contraseña" [(ngModel)]="password2" [required]="true"
                                   name="password2" [password]="!auth.showPassword">
                        </plex-text>
                    </div>
                    <plex-button type="success" size="block" [validateForm]="formulario" (click)="save($event)">
                        Confirmar mi nueva contraseña
                    </plex-button>
                    <plex-loader *ngIf="loading" type="ball-pulse-sync"></plex-loader>
                </form>
            </div>
        </div>
    </plex-layout-main>
</plex-layout>